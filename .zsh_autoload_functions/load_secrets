# vim: filetype=sh
unlock_bw_if_locked() {
  if [[ -z $BW_SESSION ]]; then
    >&2 echo "bw locked - unlocking into a new session"
    export BW_SESSION
    BW_SESSION="$(bw unlock --raw)"
  fi
}

load_secrets() {
  unlock_bw_if_locked
  local -r CLAUDE_PAT_ID="fe3a1613-821d-43f5-8b98-b33f00cd342d"
  local -r OPENROUTER_PAT_ID="5b5f442b-7cfb-4308-9401-b33f00da6c36"
  local claude_api_key
  claude_api_key="$(bw get notes "$CLAUDE_PAT_ID")"
  local openrouter_api_key
  openrouter_api_key=$(bw get notes "$OPENROUTER_PAT_ID")

  export AVANTE_ANTHROPIC_API_KEY="$claude_api_key"
  export AVANTE_OPENROUTER_API_KEY="$openrouter_api_key"
}

load_secrets "$@"
